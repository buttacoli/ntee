<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>ntee: /home/mbuttaco/ntee/src/Arguments.cpp Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
    </ul>
  </div>
<h1>/home/mbuttaco/ntee/src/Arguments.cpp</h1><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="preprocessor">#include &quot;Arguments.hpp&quot;</span>
<a name="l00002"></a>00002 <span class="preprocessor">#include &quot;Error.hpp&quot;</span>
<a name="l00003"></a>00003 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00004"></a>00004 <span class="preprocessor">#include &lt;iostream&gt;</span>
<a name="l00005"></a>00005 <span class="preprocessor">#include &lt;iterator&gt;</span>
<a name="l00006"></a>00006 <span class="preprocessor">#include &lt;boost/lexical_cast.hpp&gt;</span>
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 
<a name="l00009"></a>00009 <span class="keyword">namespace </span>ntee {
<a name="l00010"></a>00010 
<a name="l00022"></a><a class="code" href="classntee_1_1_arguments.html#a7ff9ebc32f462632bbd3d65d26fb1a24">00022</a> <a class="code" href="classntee_1_1_arguments.html#a7ff9ebc32f462632bbd3d65d26fb1a24" title="Initializes arg parser, and sets usage and help statements.">Arguments::Arguments</a>( <span class="keyword">const</span> std::string&amp; usage, <span class="keyword">const</span> std::string&amp; help)
<a name="l00023"></a>00023  : usage_(usage), help_(help)
<a name="l00024"></a>00024 {
<a name="l00025"></a>00025    <span class="comment">// empty</span>
<a name="l00026"></a>00026 }
<a name="l00027"></a>00027 
<a name="l00028"></a>00028 
<a name="l00029"></a>00029 
<a name="l00044"></a><a class="code" href="classntee_1_1_arguments.html#a2202bc35bfcef1f79f08fc9668854036">00044</a> <a class="code" href="structntee_1_1_settings.html" title="Structure to hold ntee configuration.">Settings</a> <a class="code" href="classntee_1_1_arguments.html#a2202bc35bfcef1f79f08fc9668854036" title="Builds a Settings structure that the ntee::Builder can use.">Arguments::parse</a>( <span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv )
<a name="l00045"></a>00045 {
<a name="l00046"></a>00046    <a class="code" href="structntee_1_1_settings.html" title="Structure to hold ntee configuration.">Settings</a> s;
<a name="l00047"></a>00047    
<a name="l00048"></a>00048    ErrIf( argc == 1 ).info(usage_);
<a name="l00049"></a>00049    
<a name="l00050"></a>00050    <span class="keywordtype">int</span> i = 1;
<a name="l00051"></a>00051    <span class="keywordtype">int</span> last_arg_index = argc-1;
<a name="l00052"></a>00052    std::string prog = argv[0];
<a name="l00053"></a>00053    <span class="keywordflow">while</span> ( i &lt; argc ) {
<a name="l00054"></a>00054       <span class="keywordflow">if</span> ( ! strcmp(argv[i],<span class="stringliteral">&quot;-h&quot;</span>) || ! strcmp(argv[i],<span class="stringliteral">&quot;--help&quot;</span>) ) {
<a name="l00055"></a>00055          std::cerr &lt;&lt; usage_ &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span> &lt;&lt; help_ &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00056"></a>00056          std::exit(0);
<a name="l00057"></a>00057       }
<a name="l00058"></a>00058       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ! strcmp(argv[i],<span class="stringliteral">&quot;--usage&quot;</span>) ) {
<a name="l00059"></a>00059          std::cerr &lt;&lt; usage_ &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00060"></a>00060          std::exit(0);
<a name="l00061"></a>00061       }
<a name="l00062"></a>00062       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ! strcmp(argv[i],<span class="stringliteral">&quot;-o&quot;</span>) &amp;&amp; i+1 &lt;= last_arg_index ) {
<a name="l00063"></a>00063          s.<a class="code" href="structntee_1_1_settings.html#a3302716eaae792cf5977461c8759e275" title="output file path name">output_filename</a>.assign(argv[++i]);
<a name="l00064"></a>00064       }
<a name="l00065"></a>00065       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ! strcmp(argv[i],<span class="stringliteral">&quot;--sock&quot;</span>) &amp;&amp; i+1 &lt;= last_arg_index ) {
<a name="l00066"></a>00066          s.<a class="code" href="structntee_1_1_settings.html#a72b416f02b5d9db4e9b14b98796bb75e" title="protocol to use when connecting">protocol</a> = (!strcmp(argv[++i],<span class="stringliteral">&quot;udp&quot;</span>))?Settings::UDP
<a name="l00067"></a>00067                                                 :Settings::TCP;
<a name="l00068"></a>00068       }
<a name="l00069"></a>00069       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ! strcmp(argv[i],<span class="stringliteral">&quot;-p&quot;</span>) &amp;&amp; i+1 &lt;= last_arg_index ) {
<a name="l00070"></a>00070          ErrIfCatch(boost::bad_lexical_cast,
<a name="l00071"></a>00071                     s.<a class="code" href="structntee_1_1_settings.html#a2d7c1cba5f83e3354b668b3304f30a00" title="port to start on (0 means wildcard!)">srv_port</a>=boost::lexical_cast&lt;unsigned short&gt;(argv[++i]))
<a name="l00072"></a>00072                   .info(<span class="stringliteral">&quot;Bad port number specification\n&quot;</span>);
<a name="l00073"></a>00073       }
<a name="l00074"></a>00074       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ! strcmp(argv[i],<span class="stringliteral">&quot;-L&quot;</span>) &amp;&amp; i+2 &lt;= last_arg_index ) {
<a name="l00075"></a>00075          s.<a class="code" href="structntee_1_1_settings.html#a0c96ee9be4f1eae5833f12449428999e" title="IP address of the L program.">L_host_ip</a>.assign(argv[++i]);
<a name="l00076"></a>00076          s.<a class="code" href="structntee_1_1_settings.html#a2562ef60f1181a9f4d737d3db29ce309" title="Port at which L is listening.">L_port</a>.assign(argv[++i]);
<a name="l00077"></a>00077       }
<a name="l00078"></a>00078       <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ! strcmp(argv[i],<span class="stringliteral">&quot;-R&quot;</span>) &amp;&amp; i+1 &lt;= last_arg_index ) {
<a name="l00079"></a>00079          ++i;  <span class="comment">// skip the -R </span>
<a name="l00080"></a>00080          s.<a class="code" href="structntee_1_1_settings.html#abb2c393223cbd8468007dc23744b469b" title="Command line args to start R with.">R_cmd</a> = &amp;argv[i];
<a name="l00081"></a>00081          <span class="keywordflow">break</span>;  <span class="comment">// Skip the rest of the args, they belong to the R side command.</span>
<a name="l00082"></a>00082                  <span class="comment">// and we&apos;ve got where they start which is enough for the execv</span>
<a name="l00083"></a>00083                  <span class="comment">// we&apos;ll use later.</span>
<a name="l00084"></a>00084       }
<a name="l00085"></a>00085       <span class="keywordflow">else</span> {
<a name="l00086"></a>00086          std::cerr &lt;&lt; <span class="stringliteral">&quot;bad argument : &quot;</span> &lt;&lt; argv[i] &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span>;
<a name="l00087"></a>00087          std::exit(0);
<a name="l00088"></a>00088       }
<a name="l00089"></a>00089       ++i;
<a name="l00090"></a>00090    }
<a name="l00091"></a>00091    
<a name="l00092"></a>00092    <span class="comment">//Print the structure</span>
<a name="l00094"></a>00094 <span class="comment"></span><span class="preprocessor">   #define named_value( expr ) #expr &lt;&lt; &quot; = &quot; &lt;&lt; (expr) &lt;&lt; &quot;\n&quot;</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span>   std::cout &lt;&lt; named_value( s.<a class="code" href="structntee_1_1_settings.html#a72b416f02b5d9db4e9b14b98796bb75e" title="protocol to use when connecting">protocol</a> )
<a name="l00096"></a>00096              &lt;&lt; named_value( s.<a class="code" href="structntee_1_1_settings.html#a2d7c1cba5f83e3354b668b3304f30a00" title="port to start on (0 means wildcard!)">srv_port</a> )
<a name="l00097"></a>00097              &lt;&lt; named_value( s.<a class="code" href="structntee_1_1_settings.html#a3302716eaae792cf5977461c8759e275" title="output file path name">output_filename</a> )
<a name="l00098"></a>00098              &lt;&lt; named_value( s.<a class="code" href="structntee_1_1_settings.html#a0c96ee9be4f1eae5833f12449428999e" title="IP address of the L program.">L_host_ip</a> )
<a name="l00099"></a>00099              &lt;&lt; named_value( s.<a class="code" href="structntee_1_1_settings.html#a2562ef60f1181a9f4d737d3db29ce309" title="Port at which L is listening.">L_port</a> )
<a name="l00100"></a>00100              &lt;&lt; <span class="stringliteral">&quot;s.R_cmd = [&quot;</span>;
<a name="l00101"></a>00101    <span class="keywordtype">int</span> n = 0;
<a name="l00102"></a>00102    <span class="keywordflow">while</span>( s.<a class="code" href="structntee_1_1_settings.html#abb2c393223cbd8468007dc23744b469b" title="Command line args to start R with.">R_cmd</a>[n] != 0 ) {
<a name="l00103"></a>00103       std::cout &lt;&lt; s.<a class="code" href="structntee_1_1_settings.html#abb2c393223cbd8468007dc23744b469b" title="Command line args to start R with.">R_cmd</a>[n++] &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>;
<a name="l00104"></a>00104    } 
<a name="l00105"></a>00105    std::cout &lt;&lt; <span class="stringliteral">&quot;]\n&quot;</span>;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107    <span class="keywordflow">return</span> s;
<a name="l00108"></a>00108 }
<a name="l00109"></a>00109 
<a name="l00110"></a>00110 } <span class="comment">/* end namespace ntee */</span>
</pre></div></div>
<hr size="1"/><address style="text-align: right;"><small>Generated on 27 Jul 2010 for ntee by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.1 </small></address>
</body>
</html>
